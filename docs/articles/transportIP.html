<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="TransportHealthR">
<title>Transportability analysis using IOPW with TransportHealthR • TransportHealthR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Transportability analysis using IOPW with TransportHealthR">
<meta property="og:description" content="TransportHealthR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">TransportHealthR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/transportIP.html">Transportability analysis using IOPW with TransportHealthR</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Transportability analysis using IOPW with TransportHealthR</h1>
            
      
      
      <div class="d-none name"><code>transportIP.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Transportability analysis is the statistical problem of estimating
causal effects of a treatment on a response for a target population
using data gathered from a different population i.e. the study
population. It is often used to apply findings from a randomized
clinical trial to a population with substantially different
characteristics or when it is too difficult to collect data from the
population of interest. Marginal causal effects of the study and target
populations are often not equal due to the different distributions of
effect modifiers between the two populations, so causal effect estimates
calculated using samples from the study population are biased for the
causal effect of the treatment in the target population. Therefore,
effect modification must be accounted for to obtain unbiased causal
effect estimates in the target population using data from the study
population.</p>
<p>A approach to transportability analysis is inverse odds of
participation weighting (IOPW), which weighs observations in the study
data by the inverse odds of each observation participating in the study
given its effect modifiers in addition to previous weights used for
covariate adjustment. The <code>TransportHealthR</code> package provides
functions that streamline this approach.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>Suppose we are interested in estimating the causal effect of a
medication on systolic blood pressure in a target population, but we
were only able to conduct an observational study using samples from the
study population. To obtain unbiased causal effect estimates using the
study sample, we account for the following covariates: sex (1 for male),
percent body fat, and stress (binary, 1 for stressed). Suppose further
that using domain knowledge, we know that the effectiveness of the
medication depends on stress levels and whether patients are taking
another medication (yes or no), so these variables are effect modifiers.
Notice that covariates adjusted for in the study data can also be effect
modifiers. We can perform this analysis as follows.</p>
<p>Firstly, the data from the study and target population may be
separate or merged. If they are separate, put them together in a list.
Make sure that the study data has the response and treatment columns,
while the target data do not (which is the case 99% of the time). If
they are merged, make sure that</p>
<ol style="list-style-type: decimal">
<li>The response and treatment columns for the target data are
<code>NA</code>, and</li>
<li>There is a binary variable indicating which observations are in the
study data and the target data, with participation being coded as
<code>1</code> or <code>TRUE</code>.</li>
</ol>
<p>Suppose that we have the study and target data separately as
follows.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">testData</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "studyData"  "targetData"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Study data:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Study data:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">testData</span><span class="op">$</span><span class="va">studyData</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sysBloodPressure med1 sex stress med2 percentBodyFat</span></span>
<span><span class="co">#&gt; 1         109.4347    1   1      0    0       16.84868</span></span>
<span><span class="co">#&gt; 2         115.9803    0   1      1    0       14.48698</span></span>
<span><span class="co">#&gt; 3         112.7886    0   1      0    0       15.53636</span></span>
<span><span class="co">#&gt; 4         107.6026    1   1      0    0       13.76442</span></span>
<span><span class="co">#&gt; 5         120.6845    0   0      1    0       30.08657</span></span>
<span><span class="co">#&gt; 6         113.4424    0   1      0    0       16.23256</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Target data:"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Target data:"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">testData</span><span class="op">$</span><span class="va">targetData</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sex stress med2 percentBodyFat</span></span>
<span><span class="co">#&gt; 1   0      1    0       26.12896</span></span>
<span><span class="co">#&gt; 2   1      1    0       12.04972</span></span>
<span><span class="co">#&gt; 3   1      1    0       12.55972</span></span>
<span><span class="co">#&gt; 4   0      0    1       27.07130</span></span>
<span><span class="co">#&gt; 5   1      1    0       11.85846</span></span>
<span><span class="co">#&gt; 6   0      1    0       27.64520</span></span></code></pre></div>
<p>We can now perform transportability analysis with the IOPW approach
using the <code>transportIP</code> function. This function needs:</p>
<ul>
<li>A formula expressing the marginal structural model (MSM) to be fit,
set in the <code>msmFormula</code> argument,</li>
<li>A formula or a <code>glm</code> object expressing the propensity
model i.e. a model of treatment assignment in terms of covariates, set
in the <code>propensityScoreModel</code> argument. If a formula is
provided, logistic regression is used by default. Custom propensity
weights from other weighting methods can also be provided to the
<code>customPropensity</code> argument instead; in this case, do not set
<code>propensityScoreModel</code> because it is <code>NULL</code> by
default and will be overridden.</li>
<li>A formula or a <code>glm</code> object expressing the participation
model i.e. a model of study participation in terms of effect modifiers,
set in the <code>participationModel</code> argument. If a formula is
provided, logistic regression is used by default. Custom participation
weights from other weighting methods can also be provided to the
<code>customParticipation</code> argument instead; in this case, do not
set <code>participationModel</code> because it is <code>NULL</code> by
default and will be overridden.</li>
<li>The type of MSM to be fit, set in the <code>family</code> argument.
This can be any of the families that are used in <code>glm</code> or one
of <code>"coxph"</code> or <code>"survreg"</code>. The latter options
are for survival analysis and will use default options of these methods
from the <code>survival</code> package.</li>
<li>The study and target data, separate or merged, set in the
<code>data</code> argument</li>
<li>Whether a transportability analysis or generalizability analysis is
done, set in the <code>transport</code> argument (true for
transportability, which is by default). Generalizability analysis weighs
by inverse probability of study participation rather than odds.</li>
</ul>
<p>These components are put together as follows. Here,
<code>sysBloodPressure</code> is the response and <code>med1</code> is
the treatment. Recall that sex, percent body fat and stress are
covariates controlled for in the study, while other medication and
stress are effect modifiers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transportIP.html">transportIP</a></span><span class="op">(</span>msmFormula <span class="op">=</span> <span class="va">sysBloodPressure</span> <span class="op">~</span> <span class="va">med1</span>, <span class="co"># MSM formula</span></span>
<span>                      propensityScoreModel <span class="op">=</span> <span class="va">med1</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">percentBodyFat</span> <span class="op">+</span> <span class="va">stress</span>, <span class="co"># Propensity model</span></span>
<span>                      participationModel <span class="op">=</span> <span class="va">participation</span> <span class="op">~</span> <span class="va">stress</span> <span class="op">+</span> <span class="va">med2</span>, <span class="co"># Participation model</span></span>
<span>                      family <span class="op">=</span> <span class="va">gaussian</span>, <span class="co"># Type of MSM</span></span>
<span>                      data <span class="op">=</span> <span class="va">testData</span>, <span class="co"># Data</span></span>
<span>                      transport <span class="op">=</span> <span class="cn">T</span> <span class="co"># Perform transportability analysis or generalizability analysis</span></span>
<span>                      <span class="op">)</span></span></code></pre></div>
<p>To show the results of the analysis, use the <code>summary</code>
function like you would for <code>lm</code>. This prints out covariate
balance tables pre- and post-weighting for covariates between treatment
groups (using propensity weights only) and effect modifiers (using
participation weights only) between study and target data, as well as a
summary output of the MSM model fit with the correct standard errors
calculated by <code><a href="https://sandwich.R-Forge.R-project.org/reference/vcovBS.html" class="external-link">sandwich::vcovBS</a></code>. For the effect modifiers
balance table, the weights used are inverse odds for study data and 1
for target data in a transportability analysis, and inverse probability
for all observations in a generalizability analysis. Note that if custom
participation weights are provided, the balance tables default to a
transportability analysis since only the weights for observations in the
study data are provided.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; Absolute SMDs of covariates between treatments before and after weighting:</span></span>
<span><span class="co">#&gt;                       variable          smd   method</span></span>
<span><span class="co">#&gt; sex                        sex 1.686088e-01 Observed</span></span>
<span><span class="co">#&gt; percentBodyFat  percentBodyFat 1.723317e-01 Observed</span></span>
<span><span class="co">#&gt; stress                  stress 6.216350e-02 Observed</span></span>
<span><span class="co">#&gt; sex1                       sex 3.720148e-05 Weighted</span></span>
<span><span class="co">#&gt; percentBodyFat1 percentBodyFat 1.157406e-03 Weighted</span></span>
<span><span class="co">#&gt; stress1                 stress 3.204378e-03 Weighted</span></span>
<span><span class="co">#&gt; Absolute SMDs of effect modifiers between study and target populations before and after weighting:</span></span>
<span><span class="co">#&gt;         variable          smd   method</span></span>
<span><span class="co">#&gt; stress    stress 0.6813098772 Observed</span></span>
<span><span class="co">#&gt; med2        med2 0.4965440683 Observed</span></span>
<span><span class="co">#&gt; stress1   stress 0.0001397205 Weighted</span></span>
<span><span class="co">#&gt; med21       med2 0.0002326560 Weighted</span></span>
<span><span class="co">#&gt; MSM results:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; stats::glm(formula = msmFormula, family = family, data = toAnalyze, </span></span>
<span><span class="co">#&gt;     weights = finalWeights)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  116.715      0.169  690.31  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; med11         -1.771      0.497   -3.56  0.00039 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 69.24548)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 71451  on 999  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 69107  on 998  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 6333</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>The <code>transportIP</code> object produced by the
<code>transportIP</code> function contains the model fitting objects for
the propensity model, the participation model and the MSM. You can use
methods like <code>coef</code> and <code>residuals</code> on these
objects themselves. This is not implemented by the package because they
are not as useful as implementing <code>summary</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msmResiduals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">msm</span><span class="op">)</span></span>
<span><span class="va">msmCoefficients</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">msm</span><span class="op">)</span></span></code></pre></div>
<p>The validity of transportability analysis depends on some
assumptions, including positivity and conditional exchangeability.
Positivity is the assumption that at all observed levels of covariates
and effect modifiers, the probabilities of being in the treatment group
and being the study are neither 0 nor 1, respectively. To evaluate this
assumption for the treatment assignment and study participation, use the
<code>plot</code> function with <code>type = "propensityHist"</code> or
<code>type = "participationHist"</code>, respectively. This outputs
mirrored histograms of probabilities of being in the treatment group for
different treatment groups or of participating in the study for the
study and target data, respectively. Non-overlap of the ranges of the
histograms suggest violations of positivity.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"propensityHist"</span><span class="op">)</span></span></code></pre></div>
<p><img src="transportIP_files/figure-html/IPWeighting-hist-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"participationHist"</span><span class="op">)</span></span></code></pre></div>
<p><img src="transportIP_files/figure-html/IPWeighting-hist-2.png" width="700"></p>
<p>Conditional exchangeability is roughly the assumption that the only
possible confounding is due to the controlled covariates and effect
modifiers. Under this assumption, IOPW estimates will be reliable if the
weighted distributions of covariates and effect modifiers are similar
between treatment groups and the study and target data, respectively.
This can be (partially) evaluated using standardized mean differences
(SMDs), which are shown in table form by the <code>summary</code>
function. The <code>plot</code> function with
<code>type = "propensitySMD"</code> or
<code>type = "participationSMD"</code> provides graphical versions of
these tables. A general guideline is that an SMD of below 0.1 indicates
balance.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"propensitySMD"</span><span class="op">)</span></span></code></pre></div>
<p><img src="transportIP_files/figure-html/IPWeighting-smd-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"participationSMD"</span><span class="op">)</span></span></code></pre></div>
<p><img src="transportIP_files/figure-html/IPWeighting-smd-2.png" width="700"></p>
<p>Model coefficient plots showing confidence intervals of the effect
estimates are provided by <code>plot</code> function with
<code>type = "msm"</code>. The standard errors are the correct ones
calculated by <code><a href="https://sandwich.R-Forge.R-project.org/reference/vcovBS.html" class="external-link">sandwich::vcovBS</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span>, type <span class="op">=</span> <span class="st">"msm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="transportIP_files/figure-html/IPWeighting-msm-1.png" width="700"></p>
<p>Note that all plot outputs are <code>ggplot</code>s, so if you have
<code>ggplot2</code> installed, you can customize them further.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Quang Vuong.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
